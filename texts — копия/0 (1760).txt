подробности реализации протокола синхронизации времени блог компании вчера подробности реализации протокола синхронизации времени блог компании системное администрирование сетевые технологии сетевое оборудование введение  концепция построения цифровой подстанции электроэнергетике требует синхронизации точностью мкс проведения финансовых транзакций также требуется точность мкс этих приложениях точности времени недостаточно  протокол синхронизации описанный стандартом позволяет добиться точности синхронизации несколько десятков наносекунд позволяет отправлять пакеты синхронизации сети  основными областями применяется являются   энергетика контрольно измерительное оборудование оборонно промышленный комплекс телеком финансовый сектор  данном посте разбирается работает протокол синхронизации  опыта промышленности часто встречаемся этим протоколом энергетических приложениях соответственно обзор сделаем оглядкой энергетику  необходим  данный момент сто пао россети сто пао фск еэс содержатся требования организации шины процесса обеспечением синхронизации времени  связано это шине процесса подключаются терминалы релейной защиты устройства измерения которые шину процесса помощи называемых потоков потоки передают мгновенные значения тока напряжения  терминалы релейной защиты используют значения реализации защит присоединений точность измерений времени небольшой некоторые защиты могут ложно отрабатывать  например жертвой слабой синхронизации времени могут стать защиты абсолютной селективности часто логика подобных защит строится сравнении двух величин величины расходятся достаточно большое значение защита срабатывает величины измерить точностью времени мс получить большую разницу значения самом деле находятся норме измерить точностью мкс  версии  протокол изначально описан году стандарте имел название году выпущен обновленный стандарт который описывает версии протокола улучшена точность стабильность сохранена обратная совместимость первой версией протокола также году вышла версия стандарта описывающая эта версия добавляет небольшие улучшения является обратно совместимой  другими словами имеем следующую картину версиями   нюансы  несовместимость предполагает устройство поддержкой сможет синхронизироваться точных часов работающих синхронизации используют разные форматы сообщений  совместить устройства устройства одной сети таки некоторые производители позволяют портах граничных часов выбирать версию протокола граничные часы могут синхронизироваться синхронизировать другие подключенные часы  устройства какие бывают различаются  стандартом описано несколько типов устройств приведены таблице  устройства взаимодействуют друг другом лвс используя  устройства называются часами часы берут точное время гроссмейстерских часов  типов часов   ведущие ведомые часы синхронизируются помощи меток времени сообщениях типа сообщений протоколе   это синхронизированные сообщения которые предполагают генерацию метки времени момент отправки сообщения момент приема сообщения требуют меток времени могут содержать метки времени связанных сообщений    далее будут рассмотрены типы сообщений подробно  основные проблемы синхронизации  передаче пакета синхронизации локальную сеть задерживается коммутаторе канале передачи данных любой коммутатор давать задержку около мкс недопустимо нам конечном устройстве необходимо получить точность мкс это речь идет энергетику другие приложения могут требовать большей точности  описаны несколько алгоритмов работы которые позволяют фиксировать задержку времени корректировать  алгоритм работы нормальной работе протокол работает две фазы   фаза установка иерархии ведущие часы ведомые часы фаза синхронизация часов помощи механизма  фаза установка иерархии мастер слэйв  каждый порт обычных граничных часов имеет определенное количество состояний ведомые часы ведущие часы стандарт описывает алгоритм перехода этими состояниями программировании алгоритм называется конечным автоматом машиной состояний подробнее  конечный автомат использует алгоритм установки мастера соединении двух часов  данный алгоритм позволяет часам брать обязательства гроссмейстерских часов вышестоящие гроссмейстерские часы теряют сигнал отключаются сети т д  переходы состояниями соответствии кратко отображены следующей схеме   информация часах другом конце провода присылается специальном сообщении эта информация получена алгоритм машины состояний отрабатывает выполняется сравнение какие часы порт лучших часах становится ведущими часами  простая иерархия представлена схеме ниже пути могут содержать прозрачные часы участвуют установлении иерархии ведущие часы ведомые часы    фаза синхронизация обычных граничных часов  сразу установки иерархии ведущие часы ведомые часы начинается фаза синхронизации обычных граничных часов  синхронизации ведущие часы отправляют ведомым часам сообщение содержащее метку времени  ведущие часы могут   одноступенчатые двухступенчатые  одноступенчатые часы синхронизации посылают одно сообщение  двухступенчатые часы синхронизации используют сообщения  фазы синхронизации могут использованы механизма   механизм запроса ответа задержки механизм измерения задержки соседнего узла  начала рассмотрим механизмы самом простейшем случае применяются прозрачные часы  механизм запроса ответа задержки  механизм предполагает шага   измерение задержки передаче сообщения ведущими часами ведомыми выполняется помощи механизма запроса ответа задержки выполняется коррекция сдвига точного времени  измерение задержки   время отправки сообщения ведущими часами время приема сообщения ведомыми часами время отправки запроса задержки ведомыми часами время приема ведущими часами  ведомые часы знают время могут рассчитать среднюю задержку передаче сообщения синхронизации рассчитывается следующим образом    передаче сообщения вычисляется задержка времени мастера слэйву  передаче сообщений вычисляется задержка времени слэйва мастеру  этими двумя значениями возникает асимметрия появляется ошибка коррекции ухода точного времени ошибка обуславливается вычисленная задержка является средним задержек задержки равны друг другу будем корректировать время неточно  коррекция сдвига точного времени  задержка ведущими часами ведомыми часами известна ведомые часы выполняют коррекцию времени    ведомые часы используют сообщение опциональное сообщение расчета сдвига точного времени передаче пакета ведущих часов ведомым сдвиг рассчитывается следующей формуле    механизм измерения задержки соседнего узла  данный механизм также использует шага синхронизации   устройства измеряют задержку времени соседей порты используют корректировка сдвига точного времени  измерение задержки устройствами поддерживающих режим  задержка портами поддерживающими механизм измеряется помощи следующих сообщений    порту известно время рассчитать среднюю задержку рассчитывается следующей формуле    затем порт использует это значение расчете поля корректировки каждого сообщения опционального сообщения которые проходят данное устройство  итоговая задержка равна сумме задержки передаче данное устройство средней задержке передаче канал данных содержащейся задержки данном сообщении включенной вышестоящих устройствах  сообщения опциональное позволяет получить задержку мастера слэйву слэйва мастеру круговую  любая асимметрия этими двумя значениями привнесет ошибку коррекции сдвига точного времени  корректировка сдвига точного времени    ведомые часы используют сообщение опциональное сообщение расчета сдвига точного времени передаче пакета ведущих часов ведомым сдвиг рас читывается следующей формуле    преимущества корректировка механизма задержка времени каждого сообщения рассчитывается ходу передачи сети следовательно изменение пути передачи повлияет никаким образом точность корректировки  использовании механизма синхронизация времени требует расчета задержки времени пройденном пакетом синхронизации пути это делается базовом обмене т е сообщения отправляются методе задержка ведущими часами ведомыми просто суммируется поле корректировки каждого сообщения  одно преимущество ведущие часы разгружаются необходимости обрабатывать сообщения  режимы работы прозрачных часов  соответственно это разобраны простые примеры предположим пути синхронизации появляются коммутаторы  использовать коммутаторы поддержки пакет синхронизации задерживаться коммутаторе примерно мкс  коммутаторы поддержкой терминологии называются прозрачными часами прозрачные часы синхронизируются ведущих часов участвуют иерархии ведущие часы ведомые часы передаче сообщений синхронизации запоминают сколько сообщение задержалось это позволяет скорректировать задержку времени  прозрачные часы могут работать двух режимах          прозрачные часы передают сообщения сопутствующие сообщения порты те которые заблокированы какими либо протоколами например  коммутатор запоминает метку времени пакет принят порт отправлен порта основании этих двух меток времени вычисляется время обработки коммутатором сообщения стандарте это время называется  время обработки добавляется поле сообщения одноступенчатые часы двухступенчатые часы    прозрачные часы измеряют время обработки сообщений проходящих коммутатор важно понимать задержка времени ведущими часами ведомыми часами вычисляется помощи механизма запроса ответа задержки ведущие часы меняются меняется путь ведущих часов ведомых задержка измеряется заново это увеличивает время переходного состояния случае изменений сети    прозрачные часы помимо измерения времени обработки сообщения коммутатором измеряют задержку канале передачи данных ближайшего соседа используя механизм измерения задержки соседнего узла  задержка измеряется каждом канале обоих направлениях включая каналы которые заблокированы каким либо протоколом например это позволяет сразу вычислить новую задержку пути синхронизации изменились гроссмейстерские часы топология сети  время обработки сообщений коммутаторами время задержки аккумулируются передачи сообщений  типы поддержки коммутаторами  коммутаторы могут поддерживать   программно аппаратно  программной реализации протокола коммутатор запрашивает метку времени прошивки проблема заключается прошивка работает циклически придется подождать пока закончит текущий цикл возьмет запрос обработку истечению следующего цикла выдаст метку времени это также уйдет время получим задержку пусть такую существенную программной поддержки  соблюсти необходимую точность позволяет аппаратная поддержка случае выдача метки времени выполняется специальным ом который установлен порт  формат сообщения  сообщения состоят следующих полей   байта размер зависит типа сообщения опционально      поле одинаково сообщений размер байта  формат поля    содержит тип передаваемого сообщения например т д  содержит полный размер сообщения включая исключая заполняющие байты  определяет какому домену принадлежит сообщение  домен это несколько разных часов собранных одну логическую группу синхронизированных одних ведущих часов обязательно синхронизированных часами принадлежащими другому домену  это поле содержит различные флаги идентификации статуса сообщения  содержит время задержки наносекундах время задержки включает задержку передаче прозрачные часы также задержку передаче канал использовании режима  данное поле содержит информацию какого порта изначально отправлено данное сообщение  содержит идентификационный номер индивидуальных сообщений  поле артефакт оно осталось первой версии стандарта содержит информацию типе данного сообщения сути самое меньшим количеством опций  данное поле определяется типом сообщения    обсуждалось выше существует несколько типов сообщений типы описаны ниже  сообщение сообщение используется рассказать другим часам внутри одного домена своих параметрах это сообщение позволяет установить иерархию ведущие часы ведомые часы   сообщение сообщение синхронизации отправляется ведущими часами содержит время ведущих часов момент сообщение создано ведущие часы двухступенчатые метка времени сообщении приравнена актуальная метка времени послана сопряженном сообщении сообщение используется обоих механизмов измерения задержки  сообщение передается помощи опционально использовать    сообщение  формат сообщения идентичен сообщению ведомые часы посылают оно содержит время отправки ведомыми часами данное сообщение используется механизма запроса ответа задержки  сообщение передается помощи опционально использовать    сообщение  сообщение опционально отправляется ведущими часами содержит время отправки сообщения мастером сообщение отправляют двухступенчатые ведущие часы  сообщение используется обоих механизмов измерения задержки  сообщение передается помощи опционально использовать    сообщение  сообщение отправляется ведущими часами оно содержит время приема ведущими часами данное сообщение используется механизма запроса ответа задержки  сообщение передается помощи опционально использовать    сообщение  сообщение отправляется устройством которое запрашивает задержку оно содержит время отправки сообщения порта устройства используется механизма измерения задержки соседнего узла    сообщение  сообщение отправляется устройством которое получило запрос задержку оно содержит время приема собщения данным устройством сообщения используется механизма измерения задержки соседнего узла    сообщение  сообщение опционально отправляется устройством которое получило запрос задержку оно содержит время приема сообщения этим устройством сообщение отправляется двухступенчатыми ведущими часами  также это сообщение использоваться времени исполнения вместо метки времени время исполнения это время момента получения отправки  используются механизма измерения задержки соседнего узла    управляющие сообщения сообщение  управляющие сообщения необходимы передачи информации одними несколькими часами управляющим узлом    передача лв  сообщение передаваться двух уровнях   сетевом составе данных канальном составе фрейма  передача сообщения        профили  имеет достаточно гибких параметров которые необходимы настроить например   опции механизм измерения задержки интервалы начальные значения конфигурируемых параметров т д  несмотря ранее говорили устройства совместимы собой хорошему это устройства должна иметь одинаковые настройки взаимодействовать  поэтому существуют называемые профили профили являются группами сконфигурированных настроек определенных ограничений протокола реализовать синхронизацию времени определенного приложения  стандарт описывает профиль остальные профили созданы описаны различными организациями ассоциациями  например профиль электроэнергетики создан комитетом комитетом общества профиль носит название  профиль описывает передаваться   сети т е сообщения передаются рассылкой качестве механизма измерения задержки используется  домен умолчанию рекомендуемый домен  философии создания лежало желание уменьшить количество опциональных характеристик оставить необходимые функции надежного взаимодействия устройствами повышения стабильности системы  также определена частота передачи сообщений    сути выбора доступен параметр тип ведущих часов одноступенчатые двухступенчатые  точность должна мкс другими словами одном пути синхронизации содержаться максимально прозрачных часов трое граничных часов   теги сетевые технологии  протоколы протокол синхронизации добавить метки хабы блог компании системное администрирование сетевые технологии сетевое оборудование укажите причину минуса автор поработал ошибками  отправить анонимно 
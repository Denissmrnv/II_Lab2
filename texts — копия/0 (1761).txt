настройка связки вчера настройка связки настройка  песочницы поднять контейнер настроить автообновление сертификатов довольно статей описана довольно нестандартная схема основные моменты   разворачивается сервис контейнер проверки используется схема гораздо популярная провайдера настоящий момент управлению доменными записями   такое нужен   запрашивают сертификат нужно убедиться запрашивает права соответствующий домен использует проверки самая популярная проверка называется заключается клиенту сначала выдается специальный токен сервер делает запрос адрес проверяет ответ содержит токен хэшированный ключ клиента которому токен выписывали момента   запрос выполняется именно написано выше поэтому обязан открыт порт указанный путь доступен извне всякой аутентификации сертификаты поддерживаются хотя можете выписать сертификат сразу несколько поддоменов случае делать запросы каждый поддоменов   проверка позволяет первых обойтись открытого порта вторых использовать сертификаты требуется опубликовать токен полученный виде записи типом вручную это сделать проблема автоматизации требуется поддержка стороны провайдера крупные провайдеры предостставляют управления записями некоторых существует ы которые реализуют клиентское подключение этим провайдера плагина хотя существует      это встроенный механизм кластеризации сравнению менее функциональный зато настраивается гораздо проще доступен коробки нужен кластер нескольких машин однонодный удобен поскольку предоставляет   абстракций организации сервисов горизонтальное масштабирование сервисов поинстансное обновление лучшую поддержку рестарта возможность использования ов хотя виде котором предлагает   статье использоваться именно однонодный   конкретно делаться статье   допустим домен купленный хотите сделать сервер домене планируется несколько сервисов разделенных поддоменам пока точно знаете сколько будут это отдельные машины сервисы рамках пока знаете допускаете хотите весь трафик шел дальше маршрутизировался внутри вашей сети входящий трафик должен защищен поддомены регистрируете адрес маршрутизацию отвечать выступать терминатором   далее статье получим сертификат вашего домена поднимем виде сервиса также настроим автоматическое обновление сертификата маршрутизация запросов рассматриваться будем считать поддомен действия выполняются машины   настройка   предполагается машине установлен   упоминалось ранее создание выполняется крайне просто    посмотреть список статус узлов кластера выполните      получение сертификатов   предполагается аккаунты   получите необходимые данные использования своего провайдера случая зайдите сгенерируйте качестве типа ключа обязательно укажите сгенерируйте токен помощи будем использовать также контейнеризированным        директория которую будут сохранены сертификаты которая впоследствии подмонтирована ом использования ваш аккаунт домен которого получен сертификат данном случае   ходе выполнения спросят присылать почту ответить также разрешение публикацию факта вашего происходил запрос сертификата ответить затем ждать опубликуете значение записи   далее откройте одну консоль первой ждет пока скажете проверить консоли помощи воспользуйтесь регистрации записи это сделать интерфейс сайта впоследствии похожие действия делать настройки автообновления сертификатов   сначала подготовьте        значение выданное ом   затем установите переменные ключ секретный токен вашего ключа полученного шаге        создайте запись вашем домене обратите внимание качестве одной частей выступает ваш домен        проверьте эта запись доступна содержимое соответствует ожидаемому потребоваться время особенно генерируете запись повторно обычно минуты          вернитесь консоль ом нажмите завершит формирование сертификатов которые найти директории контейнер закончит работу   настройка сервиса   примере использоваться единственный конфигурационный файл который монтироваться любой запрос пришедший сервер отвечать статусом текстом сложных случаях понадобиться монтировать конфигов специальную директорию директории статического контента   создайте файл директории           создайте сервис    зайдите своем браузере должны увидеть страницу текстом рестарта сервиса изменения конфигурации используйте команду      автоматическое обновление сертификатов   это непросто сертификаты действуют дней рекомендует обновлять делать это вручную каждые месяца задачу автоматизировать попытаться саму логику периодического обновления перенести докер иметь ввиду следующее   запускать несколько процессов внутри контейнера сделать образ котором выполняться периодическое обновление сертификатов выполняться основная работа самый хороший вариант поддерживает одноразовые задачи задачи расписанию хотя довольно многообещающая инициатива любом случае подхватил новые сертификаты нужно сделать либо либо делается отправку сигнала сделать другого сервиса контейнера рабочий вариант сделать образ который запускает фоне качестве процесса использует это ужасно   взгляд лучшее решение управлять обновлением сертификата самой машины нашем примере этим подходом другая проблема скрипт запускаемый ом должен получить ключ токен аккаунта очень хочется хранить открытом виде помощь приходят которые доступны режиме ими воспользоваться сервис который идеологии докера должен работать см п одноразовые задачи решения проблемы предлагаю воспользоваться инструментом т   простая альтернатива показаться положить ключи открытом виде условно закрытый файл усложнять жизнь использованием непонятного инструмента конце концов сможет читать вашем сервере файлы доступные вряд утекшие ключи окажутся вашей главной проблемой случае просто используйте немного модифицируйте приложенные скрипты явно прописав туда значения ключей   скачайте код проекта        соберите проект        скопируйте полученный бинарный файл создайте символьную ссылку        проверьте работу        примере создается сервис базе которому передается переменная окружения сервис выполняет команду удостовириться переменная окружения успешно передана завершения работы сервис удаляется ом   создайте ы докере хранения ключей        обновления записи воспользуемся возможностью запускать скрипты скрипты будут запускаться сервиса созданном образа образе установленного поставляемая версия умеет слать запросы зато установленный библиотека положите скрипты сами скрипты конце статьи   обратите внимание образе установленной утилиты поэтому затруднительно проверить распространились настройки скрипт должен завершаться распространились моим экспериментам секунд это успевает произойти примеру успевает использования продакшне использовать значения некоторым запасом либо воспользоваться другим механизмом контроля распространения записей это потребует сборки отдельного образа также обратите внимание причине дает возможность удалить отдельную запись скрипт использует метод обновления записей относящихся домену потенциально рискованно   сделайте скрипты исполняемыми        проверьте работу скриптов        создайте периодическую задачу которая выполнять обновление скриптов используйте либо это ваша рабочая машина домашний сервер подойти настройте обновление сертификатов неделю первые месяца оно выполняться й месяц попытки успеть это сделать также обратите внимание умолчанию добавляет случайную задержку длительностью минут это судя всему связано слишком многие настравивают автообновление одинаково перестает справляться таким количеством запросов либо настройте запуск некруглое время используйте опцию либо увеличьте таймаут пример скрипта обновления        пример скриптов         теги     добавить метки хабы настройка  укажите причину минуса автор поработал ошибками  отправить анонимно 
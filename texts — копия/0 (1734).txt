заметки разработке мррт контроллера вчера заметки разработке мррт контроллера программирование микроконтроллеров схемотехника производство разработка электроники сделай электроника начинающих приветствую ранее рассказывал статье своем проекте контроллера заряда небольшой сэс алгоритмом поиска тмм сей проект вялотекущий нехватки времени порой утствия настроения развивается момента последней статьи сделал ревизии железа проверил разные схемотехнические решения например способы измерения тока итог пришел финальной версии аппаратной части которой сегодня пойдет рассказ   исходники железную часть проекта открыты доступны         концепция   решили просмотреть предыдущую статью старой версии железа заметили концепция устройства изменилась радикально изначально хотелось сделать довольно универсальный отладочный комплекс процессе работы понял практике удобный довольно дорогой использовать готовое устройство проблематично наверное этому приходят попытки сделать универсальное хорошее разом итог решено пересмотреть реализацию пользу полноценного завершенного устройства которое валяться полке отладочных плат займет свое место небольшой сэс доме даче   момент старта проекта цели сделать дешевое устройство хотя некоторые люди писали качестве претензии использование редких компонентов цели делать дешево результате ухода универсального модуля цена компонентов цифровой части резко уменьшилась решено перекачать деньги силовую часть поставив интересные силовые ключи токовые шунты твердотельные кондеры модуль итоге той себестоимости немного улучшились ттх преобразователя снизилась температура устройства целом   интерфейсы   первой версии контроллера реализован преобразователь предусмотрен разъем ом питанием подключения самодельной панели это интересно итоге оказалось слишком избыточно логично объясню почему   первых это очень пока популярно фоне очень многих современных железках начинают применять идет совместимости прогресс остановить совмещаться особо поэтому решил заменить сделать единственным проводным интерфейсом   вторых решил отказаться использования дисплея такового гирлянды светодиодов вешать дисплей контроллер управляет преобразователем хотелось делать отдельную плату одним мк дисплеем кнопками светодиодами оказалось довольно дорого тому стоит задаться вопросом часто будете ходить условный сарай смотреть дисплей месяца эксплуатации контроллера первой ревизии сделал разу намекает бесполезность однако хочется знать происходит системой сколько энергии выработано всякое такое реализации удаленного мониторинга   третьих реализации удаленного монтиронга решил поставить данный чип обходил стороной наткнулся статью которая рассказывала это корпусе х мм который разработчики уместили саму флеш память кварц дискретные элементы остается накинуть питание антенну это очень компактное решение сильно меньше любого модуля тех видел важно т модули плату просто влезали   конечном счете пришел варианту дисплей индикация самом устройстве отсутствуют полностью вывод информации осуществляется морду приложение вернее осуществляться т разу работал реализовал часть одно радует сети информации примеров работы значит скором времени реализую мониторинг воздуху   измерение тока   ревизиях разные способы измерения тока т это пет проект городить захочется решил попробовать поделюсь своими соображениями первой ревизии предыдущей статье использовал датчики эффекте холла принципе справились своей задачей ряд минусов   чувствительны металлическим элементам рядом ними процессе экспериментов попробовал сделать корпус стали резка гибка сварка порошковая покраска получилось дешево вполне симпатично начинали сходить ума плата оказывалась внутри корпуса напряжение выходе датчика начинало плавать мв обе стороны никакими цифровыми фильтрами полечить это получилось поставить болт типа м весело становится   номинальном токе датчик начинал греться очень расстраивало согласно дш попробовал добавить параллельно нему резистор точность начала существенно плавать вместо получил несколько огорчило   датчики продаются закупаю т удобно получить желаемые компоненты одной посылке почему данный производитель некоторые другие отсутствует     следующими бой пошли шунты датчики работать ними одно удовольствие позволяют измерять ток плюсе питания это удобно т потенциал земли остается равным всей плате включим шунты разрыв земли получится земле разных потенциала которые будут зависеть падения напряжения шунтах тока   случай шунты плюсе нам измерять ток одном шунте ток втором напряжение входе выходе      это эквивалентная схема мррт контроллера сильно упрощена суть понятна удобства ток задан шунты контроллере мом вспомнить закон ома шунте падать ом наблюдаем данном случае очень удобно измерять напряжение входе солнечной панели выходе акб т земля сплошная ацп сидит всяких трудностей измерить напряжение любой точки схемы обычный делитель перенесем шунты землю земля цифровой части окажется двумя шунтами посмотрим покажут вольтметры      земля ацп расположена шунтами измерения идут относительно точки получается ситуация знаем реального напряжения входе реального напряжения выходе т шунты вносят свой вклад это мало свинца принципе терпимо аккумуляторы эта десятка очень быстро убьет самих банка установлена плата защиты полноценный определение тмм это скажется случае выкрутиться например измерение тока сводится обычному измерению падения напряжения значит можем посчитать входное напряжение измерено падение соответственно получения выходного напряжения измерено падение итог      процесс измерения напряжения даст нам значение измерено процесс измерения тока даст значения падение падение считать сложно сказал излишне точность теряется дополнительно одним решением могло измерение напряжение входе выходе помощью операционного усилителя оу включенного дифференциальном режиме это потребует лишний оу поэтому очень удобно использовать холлы включенные плюсе однако минусы цена пару датчиков очень радовали   стоит отнести минусам подобных датчиков ограниченность масштабирования дело ограничение напряжению измеряемой цепи обычно это значение пределах дальнейшем планы сделать мррт измерять подобным методом получится хочется получить железку которая довольно легко масштабируется напряжению току глобальных переделок   исходя решил поискать альтернативу хуже дешевле решил обратиться опыту других проектов различных промышленных контроллеров некоторых стояли датчики основном китайцев остальных случаях сделано примитивно шунт минусе усиление оу дальше ацп почитав форумы различные статьи данном варианте наткнулся очередной холивар кратко проблема разными потенциалами измерять плюс цена простота надежность тому равно измеряю ток известно падение шунте поэтому решил макетке собрать данный вариант работало работало хорошей точностью обрадовался оказалось ложка дегтя хотя предсказуемая земля контроллера довольно грязная длинной цепи шунта оу появлялся шум сказывалось различие потенциалов разных точках полигона оно мизерное фоне пары мв существенное победить это аппаратно решил поступить просто использовать оу дифференциальном режиме поставив оу ближе мк сигнал шунта оу примерно мм тянуть дифференциальной парой результате получил очень приличный результат совокупностью цифровым фильтром      данное решение оказалось самым дешевым это позволило поставить нормальный шунт оу приличной полосой измерять напряжение решил относительно земли ацп применяя оу диф режим принципе моей задачи получилось измерять довольно точно т сама система инертна ток напряжение панели акб изменяется быстро накапливать большой массив данных ацп последующей фильтрации панель акб генерируют либо шум значит практически помехи идут самого преобразователя ними побороться синхронизировал старт ацп измерение попадало переходный процесс момент закрытия открытия транзисторов это дало свои результаты позволило применить наиболее простое дешевое решение   корпус   говорил корпус устройства это ключевых элементов особенно планируете это продавать моем случае продавать люблю железка мимо работает выглядела стыдно знакомым показать итог озадачился изготовлением корпуса пробовал разные варианты печатал принтерах разного качества заказывал листового металла коробку выглядело говно крайне убого переживало стресс теста виде падения метра бетон цены сказал дешевые изготовление   вспомнил прекрасные статьи решил посмотреть делают нормальные люди глянул примеры работ оценил свой бюджет пришел выводу нужна фрезеровка экструзия алюминия сломать нереально выглядит дорага багата симпатично механически прочный перспективе рассеивать корпус тепло изготовив плату алюминия вроде прототип изготовить очень дорого литье пластиков понравилось ценник хобби проекта экструзия алюминия последний метод понял дешевый серии изготовить штук стоит слишком дорого китайцам писал осталась фрезеровка вооружился ом нарисовал такое      первый корпус решил заказать обладателя чпу станка компании т сроки самые интересные цена адекватная работу материал доставку отдал итоге изготовили корпус очень быстро качество устроило собралось идеально резьбы нарезаны качественно точность обработки хорошая         дальнейшем нужно обработать пескоструем идеале анодировать этим займусь ближайшее время пока показал знакомым первая реакция стиле выглядит круто наверное тяжеленный ожидал получить увесистый кирпич практике оказалось вес корпуса примерно платы сборе ощущениям плитка шоколада      итоге устройство собралось минимальными зазорами размеры вырезов давал запас мм разъемы встали всяких усилий пристукивания молотком хотя опасения взятые модели окажутся достаточно точные ошибками обошлось вообще берете модели внешнего источника настоятельно рекомендую проверять хотя внешние габариты элементов которые задают габариты которые выполняются вырезы проблем должно   реализация аппаратных защит   данная тема заслуживает полноценного холивара лишь опишу свой опыт думайте классическим способом реализации защиты току напряжению является прямое использование компаратора подключенного шунту делителю напряжения сигнал ошибки которого подается триггер обрывающий шим сигналы каналов защиты логично заменить большое количество дискретной логики это работает работает занимает место плате добавляет себестоимости   благо современных контроллерах которые заточены работу преобразователях другие компоненты имеются внутри контроллера например используемом мною быстрых компаратора сигналы которых заведены входы аппаратной защиты внутри мк имеется цап которым регулировать опорный сигнал компаратора самым задавать порог срабатывания защиты это внутри выглядит примерно      видите нужно реализации защиты мк значительно упростить внешнюю обвязку сократив количество примененных компонентов изначально верил надежность данной реализации защиты применив качестве эксперимента парочке проектов проблем выявил время срабатывания защиты примерно мкс достаточно многих задачах стоит отметить гибкость решения наличие аппаратных фильтров сигналах ошибки итоге остановился именно реализации защиты мррт контроллере   стоит отметить встроенные оу возможность включить входы ацп дифференциальном режиме например применить измерения напряжения избавиться необходимости вычислять входное выходное напряжение однако цепь измерения тока стал применять т усиление достаточно высокое полоса единичном усиление пожалуйста   итоги   данном этапе получил финальный вариант аппаратной части контроллера будущем возможно будут какие исправления переделки незначительные дальше усилия будут брошены написание софта реализации аппаратно заложенного функционала пока работает лишь режим батарей паре сканирующим алгоритмом тмм необходимо поднять добавить популярные алгоритмы поиска тмм изобрести морду мониторинга планах перенос проекта открытый   исходники железную часть проекта открыты доступны теги     сэс контроллер заряда  добавить метки хабы программирование микроконтроллеров схемотехника производство разработка электроники сделай электроника начинающих укажите причину минуса автор поработал ошибками  отправить анонимно 
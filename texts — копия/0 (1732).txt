конференция подлинное тестирование проникновение часть блог компании вчера конференция подлинное тестирование проникновение часть автор оригинала блог компании информационная безопасность конференции сделай перевод аналитики полагают настоящее время мире существует порядка миллиардов устройств области интернета вещей устройства завоевывают свое место рынке буквально взбираясь вверх человеческим задницам оказалось дешевые маломощные радиочипы отлично подходят домашней автоматизации также меняют способ взаимодействия человека секс игрушками докладе погрузимся мир теледильдоники технологии секса расстоянии которой осязательные температурные прочие ощущения передаются партн рами двустороннюю линию связи докладчик расскажет безопасность радиоэлектронных анальных сек игрушек противопоставить злоумышленнику который находит использует уязвимости каждом уровне стека конечном счете это позволяет компрометировать сами секстойз устройства которым подключаются    хакер ником начал карьеру разработчик видеоигр таких игровых консолей таких попутно пытаясь взломать момент консоли обзавелись серьезными системами безопасности перешел доморощенного разработке техник взлома известен своей работой хотя также внес вклад разработку эксплойтов популярнейших веб браузеров стеков виртуализации вероятно увлекся взломом умных анальных пробок  конференция подлинное тестирование проникновение часть    безусловно управлять входящими сообщениями малой длине строки например символов вполне достаточно выполнения вредоносного слайде показан пример тега длиной символов изображения несуществующего источника который заставляет приложение вывести сообщение ошибке это сообщение выводиться всякий загрузка изображения действительно невозможна скриншоте видно подключение скомпрометированный донгл позволяет выполнить вредоносный    ограничение символа напрягает трудно реализовать объемную полезную нагрузку это вполне возможно итак видите успешно скомпрометировали приложение помощью ключа находимся полпути тому совершить обратный взлом скомпрометировать приложение помощью хакерского баттплага участке донгл компьютер взлом происходить двумя способами компьютер скомпрометировать донгл донгл скомпрометировать компьютер  донгл действует маленький мостик баттплагом приложением возникает вопрос использовать уязвимость скомпрометировать приложение компьютере непосредственно баттплаг сожалению ответ вопрос отрицательный причина существует одно ограничение длины символов сообщений которые приходят баттплага приложению    донгл просто запаковывает сообщения баттплага пересылает приложению шаге вставить свой код однако принять сообщение длиной байтов достаточно проведения атаки методом однако прошивке донгла баг отсутствует проверка нуль терминатора конце строки поэтому сможете разместить некоторые неинициализированные данные окончания ти символьной строки удастся отправить приложению символов сожалению нашел способа использовать уязвимость практике такую возможность стоит иметь виду  таким образом проблема состоит вероятно сможете использовать уязвимость заставить приложение выполнить код полученный непосредственно баттплага это печально печальней посмотреть прошивку донгла видно принципе делает полученными данными просто копирует новую строку отправляет дальше поэтому сможем использовать уязвимость атаки способом переполнением буфера памяти однако осуществить взлом приложения напрямую баттплага возможно получится это сделать цепочке баттплаг донгл компьютер микросхема донгла позволяет разместить гораздо кода требуется оригинальной программы разработчиков    флэш памяти донгла имеется область зарезервированная загрузчик область самого приложения закрытая область драйвера железа чипа обрабатывается протокол например приложение хочет отправить игрушке сообщение оно обращается вызов кроме этих х областей донгле имеется неиспользуемая область флэш памяти достаточного большого объема найти уязвимость стеке нужно использовать реверс инжиниринг поскольку это таким образом поступил найти уязвимость прошивки баттплага данном случае очень просто проследить потоком данных легко определить код который обрабатывать сообщения    справа слайде видите обработчик входящих пакетов профиль общих атрибутов которым сути является донгл частности это обработчик чтения типу ответных пакетов являюсь специалистом устройствам думаю суть заключается донгл считывает тип периферийного устройства задействует обработчики вариантов атрибутов связанных этим типом это означает фактически получить атрибута причем размер каждого обработчика пары данных атрибутов кодируется поле внутри пакета позволяет ими управлять    слайде показан образец такого пакета клиенты могут отправлять пакет запроса который содержит тип диапазон дескрипторов чтения серверы которые отвечают запрос возвращают данные связанные обработчиками пределах диапазона соответствующего этому типу количество пар дескриптор данные определяется путем деления длины оставшегося пакета длину поля пары дескриптор данные причем это поле составляет    слайде показана работа интересующей функции видите пакет заполняется данными массива атрибутов причем выделяется фиксированная длина буфера сюда помещается значение дескриптора затем связанный указатель массив атрибутов представляет собой двоичные данные которые размещаются внутри буфера шестнадцатеричном формате данные выделены синим цветом рядом ними размещается дескриптор связанный указатель выделены оранжевым цветом аналогично выглядит пакет второго третьего обработчика  уязвимость состоит следующем прочесть расположенный справа код увидеть помещенный фиолетовую рамку параметр длина входящего сообщения значение которого полностью контролируется потенциальным злоумышленником разместить нулевое значение получим бесконечный цикл    бесконечным цикл становится код проверяет находятся данные которые записывает выходной буфер внутри выходного буфера результате получаем классическое переполнение буфера стека поскольку устройстве сразу происходит выполнение кода  присвоив нулевое значение получив бесконечный цикл фактически заменяете мусором данные однако это неудачное решение оно наверняка вызовет сбой устройства использовать значение равное оно ограничит количество байтов которые находятся внутри входящего сообщения это означает следующее сможете слегка переполнить буфер затем буфер который базируется стеке получит возможность повредить находится рядом    посмотрим выглядит стек переполнения желтым цветом выделен массив атрибутов буфера котором говорили синим сохраненные регистры оранжевый это обратный адрес установив длину атрибута равную х можем вызвать переполнение множество пар указателя дескриптор данные дескрипторы состоят байтов верхних байта дескриптора очищаются буфер который переполняем находится стеке имеющем кукиз    далее испытываем систему посылаем пакет полный байтов х длиной атрибута х получается переписываем обратный адрес указателем наши атрибутивные данные поскольку это означает каждый возврате функции исполняться код который находится внутри нашего пакета единственное ограничение нам нужно обратный адрес имел установленный младший значащий бит поэтому код выполняется режиме процессор поддерживает режим    также переписываем несколько локальных переменных нужно следить переписать используемое обратном пути принципе получаем классический бэкдор пакет обратите внимание данный стек увидите переписанное соответствует границе вызовет сбой программы  одно требование касающееся сохраненных регистров это локальные переменные которые переписываются возврате функции    используется разыменования х битной границы несоответствие содержимого границе вызовет сбой программы поэтому нужно сделать соответствовал находился пределах границы установлен  поэтому нам нужно убедиться работоспособности данного пакета счастью это действительно легко способ которым распределяет входящие пакеты представляет собой кольцевой буфер каких либо принудительных требований выравнивания дал возможность убедиться контролировать выравнивание последующего пакета путем изменения длины предыдущего пакета    желтым синим цветом выделены пакета которые отправляются отправлен пакет эксплойта это позволяет контролировать выравнивание последнего пакета сделать таким вызвал сбой программы добиваемся  замечу существует некое инженерное препятствие предоставляет интерфейс отправки необработанных пакетов обхода использовать варианта реализовать свой собственный стек взломать некоторые хуки оригинальных пакетах поскольку ленив выбрал вариант  хуки достаточно просты требуют некоторого реверс инжиниринга способы взлома найти интерфейс получается довольно грязный никаких гарантий это сработает получилось использовать     указатель вызывает всякий отправляет пакет поэтому заранее модифицировать     хук вызывает всякий получения пакета возвращаемое значение определяет должна пропущена нормальная обработка     выглядит функция отправки необработанного пакета данному соединению  обработать х байтов кода нужно послать несколько пакетов справа видите кольцевой буфер входящих пакетов зеленым цветом показан первый пакет код оболочки который выполняет вызов функции управляемыми параметрами затем возвращается чистым желтым цветом показан второй пакет это буфер данных который использован вызовом функции синим цветом изображен третий пакет буфер содержащий значения параметров вызова функции оранжевым пакет запускающий уязвимость помощью инструкции    возврата чистой функции можем снова отправить пакет отправка этих пакетов выполняет любой произвольный кусочек кода внутри донгла это проделывать снова снова    это удобно таким образом действительно могу просто вызывать несколько скопировать объемный бинарник кода оболочки затем вызовем функцию пропатчить оригинальный код донгла памяти используем это компрометации установленного компьютер приложения поскольку полезная нагрузка велика отправляем генерируем коде оболочки самом донгле шелл код выглядит следующим образом    результате этих манипуляций получается следующее можем контролировать приложение можем контролировать донгл баттплаг    участке баттплаг донгл возможны способа взлома донгл скомпрометировать игрушку баттплаг скомпрометировать донгл компьютер бонусом идет уязвимость присутствует изделиях любых устройствах использующих клиентской части  итак возможность скомпрометировать приложение помощью баттплага это использовать просто исполняем код внутри приложения вопрос это нам дает оказывается приложение запускается работает предоставляет поистине неограниченные возможности обладая полномочиями администратора получить доступ файлам компьютере выполнить произвольный код внедрить получить доступ сети далее    следующий вопрос создать программу вымогатель которая просто заражает баттплаг компьютер пользователя существует способ распространить дальше сделав вирусной имеем взлом локальном уровне хакера намного полезнее получить контроль множеством пользовательских компьютеров интернет нам это сделать социальные функции игрушки такие видеочат текстовый чат передача картинок само дистанционное управление существенно расширяют поверхность атаки  удаленное управление представляет собой отличную цель разработчик хочет использовать проприетарную программу обязательно будут баги уязвимости этим воспользоваться например отправить партнеру объект содержащий команды примеру команду     приемник анализирует входящий генерирует команду игрушки отправляет дальше причем существует режима первый режим посылает команду одной конкретной секс игрушке второй режим посылает команду всем удаленным игрушкам правильно проверяются входящие данные поскольку очень гибок код ожидая число вместо получить целую строку можем контролировать команды посылаемые игрушке вероятно сможем использовать баг парсера донгла следующем слайде оранжевой рамкой выделено используются данные синей проверяются баг состоит приложение проверяет должным образом команды самом деле является целым числом данном случае режиме проверяется лишь показатель интенсивности вибрации передадите целое число которое нуля параметр пройдет проверку передать строку число кавычках система примет примет строку виде комбинации чисел букв например    видите эта проверка позволяет нам ввести текстовую команду однако посмотрите нижнюю часть кода увидите такую проверку приложение проверяет условие введем пройдем проверку поскольку приложение посчитает данное выражение виде строки меньше введем строку проверкой неравенства вида система посчитает верным смотря это целое число вообще число буквенно числовая комбинация сути это означает можем ввести команде произвольную строку которая отправлена донглу это позволяет нам отправить код эксплойта точно проделали это ранее компрометации донгла парсер единственная разница состоит это сделать интернет    итак благодаря багу реализации фильтра проверки входящих данных получили возможность удаленно интернету приложение скомпрометировать донгл который очередь можем взломать компьютер пользователя взлом донгла является отличной штукой условием успеха является согласие партнера передать замаскированному злоумышленнику удаленный контроль игрушкой это удобно целевой атаки совершенно непригодно вирусной  однако текстовый чат картинки требуют никаких разрешений прекрасно позволяет провести классическую атаку отослав текстовом сообщении чата вредоносный код рассылка вируса становится тривиальной просто создайте нужную функцию заспамьте своих друзей    этапе можем выполнить код путем отправки сообщения основном достигли своей цели конечная полезная нагрузка работает   сделай должно происходить машине жертвы захвати объект который позволит получить доступ чату отправь полезную нагрузку которая загрузит скрипт компьютеры твоих друзей   таким образом скомпрометировали каждый узел сети баттплага интернета скомпрометировать любое устройство любого устройства создали вирус названием червь задницы    обещал продемонстрирую живое видео первое покажу это использование перехвата соединения баттплагом обычной виртуальной машиной которой подключен донгл попробую включить баттплаг надеюсь слышите звуки вибрации смех зале итак это сработало попробую добавить игрушку панель управления приложения видите программа нашла подождите минутку забыл запустить процесс единственная причина которой данном режиме нужно использовать заключается это облегчает живое демо практике можете перехватить существующее соединение необходимости сниффинга запускаю штуку просто упростить эксперимент повторим сначала видите соединение игрушкой установлено    сниффер слева показывает обнаружил это соединение итак приложение которое связано нашей секс игрушкой знаю слышите действительно могу управлять баттплагом сдвигает ползунок вверх слышен усиливающийся звук вибрации выключу штуку двигает ползунок вниз звук вибрации исчезает нужно взломать это соединение копирую несколько параметров вставляю строку конце ввожу параметр команду перехвата соединения    это сработает убьет связь приложением видите окне приложения появилось сообщение связь устройством потеряна спасибо отличный инструмент баттплаг отключился приложения управляется виртуальной машины теоретически должны состоянии дистанционно заставить вибрировать набираю команду видите работает нам удалось дистанционно управлять баттплагом помощи официального приложения аплодисменты зала собираюсь перевести режим это сработает остановить штуку ввожу соответствующую команду вибрация прекращается    беру свой смартфон проверяю смогу снова подключить игрушку приложение нахожу среди своих приложений обновление прошивки баттплага выбираю цель устройство котором необходимо обновить прошивку фактически внедрить вредоносный эксполйт    видите проходит процесс обновления экран выводится сообщение прошивка устройства успешно обновилась снова попробую подключить баттплаг приложению установленному компьютер видите происходит экране появляется заставка вымогатель аплодисменты зала    упс ваша анальная пробка зашифрована заплатите восстановление доступа важной игрушке биткойнами течение х суток иначе неделю навсегда утратите это работает  итак выполнили код донгле затем компьютере интернет добрались баттплага видите отношении безопасности эта анальная пробка очень слаба наверное сделана северной корее увидели установлена виртуальная машина которая запускала приложение будучи соединенной донглом другим железом эта вм просто подключена интернету связана компьютером моего друга успешно добились вирусного распространения вымогателя  думаю сказанного извлечь пару полезных уроков примере устройства рассмотрели насколько уязвим мир интернета вещей некоторые девайсы используются жизнеобеспечения люди осознают насколько уязвимы новые технологии взломав одну умную вещь интернет подцепить крючок другие умные устройства вашем доме надеюсь результат моего исследования применим секс игрушкам кроме намерен изучить весь код штуки присоединяйтесь ко также собираюсь сегодня опубликовать свои инструменты случай захотите начать взламывать свои собственные баттплаги    хочу поблагодарить своих друзей которые помогли пентестинге познакомили миром баттплагов являясь геями экстремалами буду называть имен аарон знаешь смех зале спасибо ребята это круто      немного рекламы  спасибо оста тесь нами нравятся наши статьи хотите видеть интересных материалов поддержите оформив заказ порекомендовав знакомым облачные разработчиков уникальный аналог серверов который придуман нами вся правда правильно делить сервер доступны варианты ядер  раза дешевле дата центре амстердаме х тв нидерландах читайте построить инфраструктуру корп класса применением серверов е стоимостью евро копейки теги безопастность теледильдоника  добавить метки хабы блог компании информационная безопасность конференции сделай укажите причину минуса автор поработал ошибками  отправить анонимно 